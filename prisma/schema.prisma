// =======================
// GENERATOR & DATASOURCE
// =======================

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ============
// ENUMS
// ============

enum Role {
  CLIENT
  BARBER
  ADMIN
}

enum AppointmentStatus {
  PENDING
  DONE
  CANCELED
}

// ============
// MODELS
// ============

model User {
  id String @id @default(cuid())

  name  String?
  email String  @unique
  image String?

  // Para barbeiro/admin: hash da senha (nunca em texto puro!)
  passwordHash String?

  role Role @default(CLIENT)

  // Relacionamentos
  appointmentsAsClient Appointment[] @relation("ClientAppointments")
  // üî• removi o appointmentsAsBarber, agora quem se relaciona com Appointment √© o model Barber

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  barber    Barber?
}

model Barber {
  id        String   @id @default(cuid())
  name      String
  email     String   @unique
  phone     String?
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // üîó rela√ß√£o com User (opcional, para login de barbeiro)
  userId String? @unique
  user   User?   @relation(fields: [userId], references: [id])

  // üîó rela√ß√£o com Appointment
  appointments Appointment[]

  @@map("barbers")
}

model Service {
  id              String  @id @default(cuid())
  name            String
  price           Decimal @db.Decimal(10, 2)
  durationMinutes Int
  isActive        Boolean @default(true)

  // Relacionamento com Appointment
  appointments Appointment[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("services")
}

model Appointment {
  id          String   @id @default(cuid())
  description String
  clientName  String
  phone       String
  scheduleAt  DateTime

  status AppointmentStatus @default(PENDING)

  // Cliente que fez o agendamento (usu√°rio logado)
  clientId String
  client   User   @relation("ClientAppointments", fields: [clientId], references: [id])

  // Barbeiro que vai atender (pode ser nulo para dados antigos / ‚ÄúSem barbeiro‚Äù)
  barberId String?
  barber   Barber? @relation(fields: [barberId], references: [id])

  // Servi√ßo escolhido (pode ser nulo para agendamentos antigos)
  serviceId String?
  service   Service? @relation(fields: [serviceId], references: [id])

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // √çndices √∫teis
  @@index([clientId])
  @@index([barberId])
  @@index([scheduleAt])
  @@index([serviceId])
  // Mant√©m o nome da tabela como "appointments"
  @@map("appointments")
}
